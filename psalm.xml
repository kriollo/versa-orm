<?xml version="1.0"?>
<psalm
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="https://getpsalm.org/schema/config"
    xsi:schemaLocation="https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd"
    errorLevel="5"
    phpVersion="8.1"
    cacheDirectory="var/cache/psalm"
    ensureArrayStringOffsetsExist="false"
    findUnusedVariablesAndParams="false"
    findUnusedCode="false"
    strictBinaryOperands="false"
    reportMixedIssues="false"
    allowPhpStormGenerics="true"
    allowStringToStandInForClass="true"
    memoizeMethodCallResults="true"
    hoistConstants="true"
    addParamTypesFromCallSites="false"
    checkForThrowsDocblock="false"
    checkForThrowsInGlobalScope="false"
    ignoreInternalFunctionFalseReturn="true"
    ignoreInternalFunctionNullReturn="true"
>
    <projectFiles>
        <directory name="src" />
        <directory name="example" />
        <ignoreFiles>
            <directory name="vendor" />
            <directory name="tests" />
            <directory name="test*" />
        </ignoreFiles>
    </projectFiles>

    <issueHandlers>
        <!-- === SECURITY FOCUS - Psalm's strength === -->
        <TaintedInput errorLevel="error" />
        <TaintedSql errorLevel="error" />
        <TaintedShell errorLevel="error" />
        <TaintedFile errorLevel="error" />
        <TaintedHtml errorLevel="error" />
        <TaintedCookie errorLevel="error" />
        <TaintedHeader errorLevel="error" />
        <TaintedCallable errorLevel="error" />
        <TaintedTextWithQuotes errorLevel="error" />

        <!-- === COMPLEMENTARY TO PHPSTAN - Focus on what PHPStan doesn't catch === -->

        <!-- Immutability and purity -->
        <ImpureMethodCall errorLevel="info" />
        <ImpurePropertyAssignment errorLevel="info" />
        <ImpureStaticProperty errorLevel="info" />

        <!-- Template and generic issues -->
        <InvalidTemplateParam errorLevel="error" />
        <MissingTemplateParam errorLevel="error" />
        <ReservedWord errorLevel="error" />

        <!-- === SUPPRESS OVERLAPPING CHECKS WITH PHPSTAN === -->

        <!-- Type checking - let PHPStan handle these -->
        <MixedAssignment errorLevel="suppress" />
        <MixedArgument errorLevel="suppress" />
        <MixedArrayOffset errorLevel="suppress" />
        <MixedMethodCall errorLevel="suppress" />
        <MixedPropertyFetch errorLevel="suppress" />
        <MixedReturnStatement errorLevel="suppress" />
        <MixedArrayAccess errorLevel="suppress" />
        <MixedArrayAssignment errorLevel="suppress" />
        <MixedStringOffsetAssignment errorLevel="suppress" />

        <!-- Redundant conditions - let PHPStan handle -->
        <RedundantCondition errorLevel="suppress" />
        <RedundantConditionGivenDocblockType errorLevel="suppress" />
        <TypeDoesNotContainType errorLevel="suppress" />
        <TypeDoesNotContainNull errorLevel="suppress" />

        <!-- === ORM-SPECIFIC SUPPRESSIONS === -->

        <!-- Magic methods and properties -->
        <UndefinedMagicMethod errorLevel="suppress" />
        <UndefinedMagicPropertyFetch errorLevel="suppress" />
        <UndefinedMagicPropertyAssignment errorLevel="suppress" />
        <UndefinedMethod errorLevel="suppress" />
        <UndefinedPropertyFetch errorLevel="suppress" />
        <UndefinedPropertyAssignment errorLevel="suppress" />
        <UndefinedClass errorLevel="suppress" />

        <!-- Dynamic property access -->
        <PossiblyUndefinedArrayOffset errorLevel="suppress" />
        <PossiblyNullArrayOffset errorLevel="suppress" />
        <PossiblyNullReference errorLevel="suppress" />
        <PossiblyUndefinedStringArrayOffset errorLevel="suppress" />
        <PossiblyUndefinedIntArrayOffset errorLevel="suppress" />

        <!-- === NOISE REDUCTION === -->

        <!-- Unused code - not our focus -->
        <PossiblyUnusedMethod errorLevel="suppress" />
        <UnusedClass errorLevel="suppress" />
        <UnusedMethod errorLevel="suppress" />
        <UnusedMethodCall errorLevel="suppress" />
        <UnusedVariable errorLevel="suppress" />
        <UnusedForeachValue errorLevel="suppress" />
        <PossiblyUnusedProperty errorLevel="suppress" />
        <PossiblyUnusedReturnValue errorLevel="suppress" />
        <UnusedClosureParam errorLevel="suppress" />
        <UnusedParam errorLevel="suppress" />

        <!-- Documentation issues - let other tools handle -->
        <UnnecessaryVarAnnotation errorLevel="suppress" />
        <InvalidDocblock errorLevel="suppress" />
        <MissingDocblockType errorLevel="suppress" />
        <MissingReturnType errorLevel="suppress" />
        <MissingParamType errorLevel="suppress" />
        <MissingPropertyType errorLevel="suppress" />

        <!-- === ALLOW FLEXIBILITY FOR ORM === -->

        <!-- Constructor and property initialization -->
        <PropertyNotSetInConstructor errorLevel="suppress" />
        <MissingConstructor errorLevel="suppress" />
        <UninitializedProperty errorLevel="suppress" />

        <!-- Return type flexibility -->
        <LessSpecificReturnType errorLevel="suppress" />
        <MoreSpecificReturnType errorLevel="suppress" />
        <LessSpecificImplementedReturnType errorLevel="suppress" />

        <!-- Array access patterns -->
        <InvalidArrayOffset errorLevel="suppress" />
        <PossiblyInvalidArrayOffset errorLevel="suppress" />
        <InvalidArrayAccess errorLevel="suppress" />
        <PossiblyInvalidArrayAccess errorLevel="suppress" />

        <!-- Argument type flexibility -->
        <InvalidArgument errorLevel="suppress" />
        <PossiblyInvalidArgument errorLevel="suppress" />
        <TooManyArguments errorLevel="suppress" />
        <TooFewArguments errorLevel="suppress" />

        <!-- === EXAMPLE/VIEW SPECIFIC SUPPRESSIONS === -->

        <!-- View templates use global variables -->
        <UndefinedGlobalVariable errorLevel="suppress" />
        <UndefinedFunction errorLevel="suppress" />
        <DuplicateClass errorLevel="suppress" />

        <!-- === QUERYBUILDER SPECIFIC SUPPRESSIONS === -->

        <!-- QueryBuilder uses flexible array structures -->
        <InvalidPropertyAssignmentValue errorLevel="suppress" />

        <!-- === FOCUS ON PSALM'S STRENGTHS === -->

        <!-- Keep these active for security and correctness -->
        <UnresolvableInclude errorLevel="error" />
        <InvalidCast errorLevel="info" />
        <InvalidOperand errorLevel="info" />
        <InvalidClone errorLevel="error" />
        <InvalidFunctionCall errorLevel="info" />
        <InvalidScalarArgument errorLevel="info" />
        <InvalidReturnStatement errorLevel="info" />
        <InvalidReturnType errorLevel="info" />
        <InvalidThrow errorLevel="error" />
        <InvalidCatch errorLevel="error" />

        <!-- Null safety - but be lenient -->
        <PossiblyNullOperand errorLevel="info" />
        <PossiblyNullArgument errorLevel="info" />
        <PossiblyNullIterator errorLevel="info" />
        <PossiblyNullPropertyFetch errorLevel="info" />
        <PossiblyNullFunctionCall errorLevel="info" />

        <!-- False positive reductions -->
        <PossiblyFalseOperand errorLevel="info" />
        <PossiblyFalseArgument errorLevel="info" />
        <PossiblyFalseIterator errorLevel="info" />
    </issueHandlers>
</psalm>
