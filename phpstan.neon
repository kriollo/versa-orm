parameters:
    level: 8
    paths:
        - src
        - example
    excludePaths:
        - src/binary/*
        - vendor/*

    # === COMPATIBILITY SETTINGS ===
    treatPhpDocTypesAsCertain: false
    checkMissingIterableValueType: true
    checkGenericClassInNonGenericObjectType: true
    reportUnmatchedIgnoredErrors: false

    # Reduce conflicts with other tools
    checkTooWideReturnTypesInProtectedAndPublicMethods: false
    checkUninitializedProperties: false # Let Rector handle property initialization

    # === ORM-SPECIFIC CONFIGURATION ===
    universalObjectCratesClasses:
        - VersaORM\VersaModel
        - VersaORM\QueryBuilder

    # Dynamic return types for ORM methods (commented out - extensions don't exist yet)
    # dynamicMethodReturnTypeExtensions:
    #     - VersaORM\PHPStan\QueryBuilderDynamicReturnTypeExtension
    #     - VersaORM\PHPStan\ModelDynamicReturnTypeExtension

    ignoreErrors:
        # === FACTORY PATTERNS ===
        - '#Unsafe usage of new static\(\)#'
        - '#Static call to instance method#'

        # === ORM MAGIC METHODS AND PROPERTIES ===
        - '#Call to an undefined method.*::(where|select|join|orderBy|groupBy|having|limit|offset|insert|update|delete|count|exists|first|get|all|find|create|save|destroy)\(\)#'
        - '#Access to an undefined property.*::\$[a-zA-Z_][a-zA-Z0-9_]*#'
        - '#Property VersaORM\\VersaModel::\$[a-zA-Z_][a-zA-Z0-9_]* \(.*\) does not accept.*#'
        - '#Call to an undefined method VersaORM\\VersaModel::[a-zA-Z_][a-zA-Z0-9_]*\(\)#'
        - '#Access to an undefined property VersaORM\\VersaModel::\$[a-zA-Z_][a-zA-Z0-9_]*#'

        # === DATABASE/PDO PATTERNS ===
        - '#Call to an undefined method PDO(Statement)?::[a-zA-Z_][a-zA-Z0-9_]*\(\)#'
        - '#Parameter \#1 \$object_or_class of function property_exists expects object\|string, array given#'

        # === RELATION PATTERNS ===
        - '#Method VersaORM\\Relations\\Relation::getResults\(\) has no return type specified#'
        - '#Method VersaORM\\Relations\\HasOne::getResults\(\) should return.*but returns.*#'
        - '#Method VersaORM\\Relations\\HasMany::getResults\(\) should return.*but returns.*#'
        - '#Method VersaORM\\Relations\\.*::execute\(\) should return.*but returns.*#'

        # === ARRAY ACCESS PATTERNS ===
        - '#Offset .* does not exist on array.*#'
        - '#Cannot access offset .* on.*#'
        - '#Offset string does not exist on array.*#'
        - '#Cannot access offset string on.*#'

        # === TEST CLASS PATTERNS ===
        - '#Property.*Test::\$.*is never written, only read#'
        - '#Property.*Test::\$.*is unused#'
        - '#Property.*Test::\$.*\(.*\) is never read, only written#'
        - '#Method.*Test::.*\(\) is unused#'

        # === MIXED TYPES IN ORM CONTEXT ===
        - '#Method .* should return .* but returns mixed#'
        - '#Parameter .* of method .* expects .*, mixed given#'
        - '#Cannot call method .* on mixed#'
        - '#Cannot access property .* on mixed#'

        # === ALLOW FLEXIBLE RETURN TYPES ===
        - '#Method .* has parameter .* with no type specified#'
        - '#Method .* has no return type specified#'
        - '#Function .* has no return type specified#'

includes:
    - vendor/phpstan/phpstan-strict-rules/rules.neon
    - phpstan-baseline.neon
